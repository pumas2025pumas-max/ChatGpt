<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Estudio Meraki | Contacto</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Work+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header class="hero">
        <div class="hero__background" aria-hidden="true"></div>
        <div class="hero__content">
            <img class="hero__logo" src="assets/logo-meraki.svg" alt="Logotipo de Estudio Meraki" width="200" height="200">
            <p class="hero__eyebrow">Estudio Meraki</p>
            <h1 class="hero__title">Soluciones legales y contables con un enfoque humano</h1>
            <p class="hero__subtitle">Acompa침amos a emprendedores, pymes y particulares brindando asesoramiento integral y cercano.</p>
            <div class="hero__cta">
                <a class="button button--light" href="https://wa.me/5491162576017" target="_blank" rel="noopener">Escr칤benos por WhatsApp</a>
                <a class="button button--ghost" href="#contacto">Enviar consulta</a>
            </div>
        </div>
    </header>

    <main>
        <section id="contacto" class="contact" aria-labelledby="contacto-titulo">
            <div class="contact__intro">
                <h2 id="contacto-titulo">Conversemos sobre tu caso</h2>
                <p>Completa el formulario o utiliza cualquiera de los medios de contacto para agendar una reuni칩n virtual o presencial con nuestro equipo.</p>
            </div>

            <div class="contact__grid">
                <div class="contact__card" aria-label="Datos de contacto">
                    <h3>Informaci칩n de contacto</h3>
                    <ul class="contact__list">
                        <li>
                            <span class="contact__label">Tel칠fono</span>
                            <a href="tel:+5491162576017">+54 9 11 6257-6017</a>
                        </li>
                        <li>
                            <span class="contact__label">WhatsApp</span>
                            <a href="https://wa.me/5491162576017" target="_blank" rel="noopener">Enviar mensaje directo</a>
                        </li>
                        <li>
                            <span class="contact__label">Correo</span>
                            <a href="mailto:ejcmeraki@gmail.com">ejcmeraki@gmail.com</a>
                        </li>
                        <li>
                            <span class="contact__label">Modalidad</span>
                            <p>Consultas online y reuniones presenciales a coordinaci칩n previa.</p>
                        </li>
                    </ul>
                    <p class="contact__note">Compartinos la mayor cantidad de informaci칩n posible para brindarte una respuesta 치gil y precisa.</p>
                </div>

                <form class="contact__form" aria-label="Formulario de contacto">
                    <div class="form__group">
                        <label for="nombre">Nombre completo</label>
                        <input type="text" id="nombre" name="nombre" placeholder="Ej. Laura Gonz치lez" required>
                    </div>
                    <div class="form__group">
                        <label for="email">Correo electr칩nico</label>
                        <input type="email" id="email" name="email" placeholder="ejemplo@correo.com" required>
                    </div>
                    <div class="form__group">
                        <label for="telefono">Tel칠fono de contacto</label>
                        <input type="tel" id="telefono" name="telefono" placeholder="Ej. +54 9 11 6257-6017">
                    </div>
                    <div class="form__group form__group--full">
                        <label for="asunto">Asunto</label>
                        <input type="text" id="asunto" name="asunto" placeholder="Servicio o 치rea de inter칠s">
                    </div>
                    <div class="form__group form__group--full">
                        <label for="mensaje">Mensaje</label>
                        <textarea id="mensaje" name="mensaje" rows="5" placeholder="Contanos brevemente tu consulta"></textarea>
                    </div>
                    <p class="form__help">Respondemos dentro de las pr칩ximas 24 horas h치biles.</p>
                    <button type="submit" class="button">Enviar consulta</button>
                    <p class="form__status" role="status" aria-live="polite" aria-atomic="true" aria-hidden="true"></p>
                </form>
            </div>
        </section>

        <section class="highlights" aria-labelledby="servicios-titulo">
            <div class="highlights__card">
                <h2 id="servicios-titulo">쮺칩mo podemos ayudarte?</h2>
                <ul>
                    <li>Constituci칩n y regularizaci칩n de sociedades, monotributo y pymes.</li>
                    <li>Asesoramiento contable e impositivo para emprendimientos en crecimiento.</li>
                    <li>Contratos comerciales, laborales y representaci칩n legal integral.</li>
                </ul>
            </div>
            <div class="highlights__card">
                <h3>Metodolog칤a Meraki</h3>
                <p>Creemos en la escucha activa, el an치lisis detallado y la comunicaci칩n clara para que tomes decisiones informadas. Cada estrategia se dise침a a medida y se acompa침a con seguimiento constante.</p>
            </div>
        </section>
    </main>

    <footer class="footer">
        <p>&copy; <span id="year"></span> Estudio Meraki. Todos los derechos reservados.</p>
        <p class="footer__legal">La informaci칩n de este sitio es meramente orientativa y no reemplaza el asesoramiento profesional personalizado.</p>
    </footer>

    <button class="chatbot__toggle" type="button" aria-controls="chatbot" aria-expanded="false">
        <span class="chatbot__toggle-icon" aria-hidden="true">游눫</span>
        <span class="chatbot__toggle-text">Asistente</span>
    </button>

    <div id="chatbot" class="chatbot chatbot--closed" role="dialog" aria-modal="false" aria-label="Asistente virtual de Estudio Meraki">
        <div class="chatbot__header">
            <div class="chatbot__heading">
                <p class="chatbot__eyebrow">Asistente virtual</p>
                <h2 class="chatbot__title">Meraki Chat</h2>
            </div>
            <button type="button" class="chatbot__close" aria-label="Cerrar chat">&times;</button>
        </div>
        <div class="chatbot__messages" role="log" aria-live="polite"></div>
        <form class="chatbot__form" autocomplete="off">
            <label class="visually-hidden" for="chatbot-input">Escribe tu consulta</label>
            <div class="chatbot__suggestions" aria-label="Preguntas r치pidas">
                <button type="button" class="chatbot__suggestion" data-message="쮺u치l es el horario?">쮺u치l es el horario?</button>
                <button type="button" class="chatbot__suggestion" data-message="Contacto por WhatsApp">Contacto por WhatsApp</button>
                <button type="button" class="chatbot__suggestion" data-message="쯈u칠 servicios ofrecen?">쯈u칠 servicios ofrecen?</button>
            </div>
            <div class="chatbot__controls">
                <input id="chatbot-input" class="chatbot__input" type="text" name="mensaje" placeholder="Escrib칤 tu consulta..." required>
                <button type="submit" class="chatbot__send">Enviar</button>
            </div>
        </form>
    </div>

    <script>
        const yearElement = document.getElementById('year');
        const currentYear = new Date().getFullYear();
        yearElement.textContent = currentYear;

        const chatbotToggle = document.querySelector('.chatbot__toggle');
        const chatbotElement = document.getElementById('chatbot');
        const chatbotCloseButton = document.querySelector('.chatbot__close');
        const chatbotForm = document.querySelector('.chatbot__form');
        const chatbotInput = document.querySelector('.chatbot__input');
        const chatbotMessages = document.querySelector('.chatbot__messages');
        const suggestionButtons = document.querySelectorAll('.chatbot__suggestion');
        const contactForm = document.querySelector('.contact__form');
        const formStatus = contactForm ? contactForm.querySelector('.form__status') : null;
        const contactSubmitButton = contactForm ? contactForm.querySelector('button[type="submit"]') : null;

        const knowledgeBase = [
            {
                keywords: ['telefono', 'tel칠fono', 'whatsapp', 'llamar', 'celular'],
                answer: 'Pod칠s comunicarte al +54 9 11 6257-6017 por llamada o WhatsApp para recibir asesoramiento inmediato.'
            },
            {
                keywords: ['correo', 'mail', 'email'],
                answer: 'Escribinos a ejcmeraki@gmail.com y te responderemos dentro de las pr칩ximas 24 horas h치biles.'
            },
            {
                keywords: ['horario', 'hora', 'cuando', 'disponible'],
                answer: 'Nuestro equipo responde consultas de lunes a viernes de 9 a 18 h (GMT-3).'
            },
            {
                keywords: ['reunion', 'presencial', 'virtual', 'ubicacion', 'direccion'],
                answer: 'Agendamos reuniones virtuales y presenciales con coordinaci칩n previa en Ciudad de Buenos Aires.'
            },
            {
                keywords: ['servicios', 'areas', 'ofrecen', 'ayuda', 'especialidad'],
                answer: 'Asistimos en constituci칩n de sociedades, gesti칩n contable, impuestos y representaci칩n legal integral para emprendedores y pymes.'
            },
            {
                keywords: ['honorarios', 'costo', 'precio', 'tarifa'],
                answer: 'Determinamos los honorarios seg칰n el alcance del caso. Contanos m치s detalles y te enviaremos una propuesta a medida.'
            },
            {
                keywords: ['documentacion', 'documentos', 'informacion', 'datos'],
                answer: 'Pod칠s adjuntar documentaci칩n relevante cuando coordinemos la reuni칩n o enviarla por correo seguro para agilizar el an치lisis.'
            },
            {
                keywords: ['gracias', 'gracias!'],
                answer: '춰Gracias a vos por escribirnos! 쮿ay algo m치s en lo que podamos ayudarte?'
            }
        ];

        function normalize(text) {
            return text
                .toLowerCase()
                .normalize('NFD')
                .replace(/[\u0300-\u036f]/g, '');
        }

        function toggleChat(forceOpen) {
            const shouldOpen = forceOpen !== undefined ? forceOpen : chatbotElement.classList.contains('chatbot--closed');

            if (shouldOpen) {
                chatbotElement.classList.add('chatbot--open');
                chatbotElement.classList.remove('chatbot--closed');
                chatbotToggle.setAttribute('aria-expanded', 'true');
                chatbotToggle.classList.add('chatbot__toggle--active');
                chatbotInput.focus();
            } else {
                chatbotElement.classList.remove('chatbot--open');
                chatbotElement.classList.add('chatbot--closed');
                chatbotToggle.setAttribute('aria-expanded', 'false');
                chatbotToggle.classList.remove('chatbot__toggle--active');
            }
        }

        function addMessage(text, sender) {
            const bubble = document.createElement('div');
            bubble.className = `chatbot__bubble chatbot__bubble--${sender}`;
            const paragraph = document.createElement('p');
            paragraph.textContent = text;
            bubble.appendChild(paragraph);
            chatbotMessages.appendChild(bubble);
            chatbotMessages.scrollTop = chatbotMessages.scrollHeight;
        }

        function getResponse(message) {
            const normalizedMessage = normalize(message);

            for (const entry of knowledgeBase) {
                const hasMatch = entry.keywords.some((keyword) => normalizedMessage.includes(normalize(keyword)));
                if (hasMatch) {
                    return entry.answer;
                }
            }

            return 'Gracias por tu consulta. Para brindarte la mejor respuesta, contanos m치s detalles o escribinos a ejcmeraki@gmail.com.';
        }

        function processUserMessage(message) {
            if (!message) {
                return;
            }

            addMessage(message, 'user');

            window.requestAnimationFrame(() => {
                const response = getResponse(message);
                setTimeout(() => addMessage(response, 'bot'), 350);
            });
        }

        function handleSubmit(event) {
            event.preventDefault();
            const userMessage = chatbotInput.value.trim();

            if (!userMessage) {
                return;
            }

            chatbotInput.value = '';
            processUserMessage(userMessage);
        }

        chatbotToggle.addEventListener('click', () => {
            const isClosed = chatbotElement.classList.contains('chatbot--closed');
            toggleChat(isClosed);
            if (isClosed && chatbotMessages.childElementCount === 0) {
                addMessage('춰Hola! Soy el asistente virtual de Estudio Meraki. Contame c칩mo podemos ayudarte.', 'bot');
            }
        });

        chatbotCloseButton.addEventListener('click', () => toggleChat(false));

        chatbotForm.addEventListener('submit', handleSubmit);

        suggestionButtons.forEach((button) => {
            button.addEventListener('click', () => {
                const suggestedMessage = button.dataset.message?.trim();
                processUserMessage(suggestedMessage);
                chatbotInput.focus();
            });
        });

        document.addEventListener('keydown', (event) => {
            if (event.key === 'Escape' && chatbotElement.classList.contains('chatbot--open')) {
                toggleChat(false);
            }
        });

        if (contactForm && formStatus) {
            const statusClasses = ['form__status--success', 'form__status--error', 'form__status--visible'];

            const updateFormStatus = (message = '', type) => {
                formStatus.textContent = message;
                formStatus.classList.remove(...statusClasses);

                if (message) {
                    formStatus.classList.add('form__status--visible');

                    if (type) {
                        formStatus.classList.add(`form__status--${type}`);
                    }

                    formStatus.setAttribute('aria-hidden', 'false');
                } else {
                    formStatus.setAttribute('aria-hidden', 'true');
                }
            };

            const validateEmail = (value) => /^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(value);

            contactForm.addEventListener('submit', async (event) => {
                event.preventDefault();

                updateFormStatus('', null);

                const formData = new FormData(contactForm);
                const nombre = (formData.get('nombre') || '').toString().trim();
                const email = (formData.get('email') || '').toString().trim();
                const mensaje = (formData.get('mensaje') || '').toString().trim();

                const validationErrors = [];
                const isEmailValid = email && validateEmail(email);

                if (!nombre) {
                    validationErrors.push('Ingres치 tu nombre completo.');
                }

                if (!email) {
                    validationErrors.push('Ingres치 un correo electr칩nico de contacto.');
                } else if (!isEmailValid) {
                    validationErrors.push('Revis치 que el correo electr칩nico tenga un formato v치lido.');
                }

                if (!mensaje) {
                    validationErrors.push('Contanos brevemente tu consulta para poder ayudarte.');
                }

                if (validationErrors.length > 0) {
                    updateFormStatus(validationErrors.join(' '), 'error');

                    if (!nombre) {
                        contactForm.elements.nombre.focus();
                    } else if (!email || !isEmailValid) {
                        contactForm.elements.email.focus();
                    } else if (!mensaje) {
                        contactForm.elements.mensaje.focus();
                    }

                    return;
                }

                updateFormStatus('Enviando tu consulta...', null);

                if (contactSubmitButton) {
                    contactSubmitButton.setAttribute('disabled', 'true');
                    contactSubmitButton.setAttribute('aria-busy', 'true');
                }

                const endpoint = (contactForm.getAttribute('action') || '').trim();
                const method = (contactForm.getAttribute('method') || 'POST').toUpperCase();
                const shouldSubmitRemotely = endpoint && endpoint !== '#';

                try {
                    if (shouldSubmitRemotely) {
                        const requestInit = {
                            method,
                            headers: {
                                Accept: 'application/json'
                            }
                        };

                        if (method === 'GET') {
                            const query = new URLSearchParams(formData).toString();
                            const requestUrl = endpoint.includes('?') ? `${endpoint}&${query}` : `${endpoint}?${query}`;
                            const response = await fetch(requestUrl, requestInit);

                            if (!response.ok) {
                                throw new Error('Error al enviar la consulta');
                            }
                        } else {
                            requestInit.body = formData;
                            const response = await fetch(endpoint, requestInit);

                            if (!response.ok) {
                                throw new Error('Error al enviar la consulta');
                            }
                        }
                    } else {
                        await new Promise((resolve) => setTimeout(resolve, 600));
                    }

                    updateFormStatus('춰Gracias! Recibimos tu consulta y te responderemos a la brevedad.', 'success');
                    contactForm.reset();
                } catch (error) {
                    console.error(error);
                    updateFormStatus('No pudimos enviar tu consulta en este momento. Intent치 nuevamente m치s tarde o utiliz치 nuestros medios alternativos de contacto.', 'error');
                } finally {
                    if (contactSubmitButton) {
                        contactSubmitButton.removeAttribute('disabled');
                        contactSubmitButton.removeAttribute('aria-busy');
                    }
                }
            });

            contactForm.addEventListener('input', () => {
                if (formStatus.classList.contains('form__status--error')) {
                    updateFormStatus('', null);
                }
            });
        }
    </script>
</body>
</html>
